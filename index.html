<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>THE WAY OF GOD BIBLE MINISTRY - Sunday School Exam</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap" rel="stylesheet">
    <style>
        :root{
            --prime-txt:#2c3e50; --btn-green:#4CAF50; --btn-green-h:#45a049; --bg-grad-s:#ffecd2; --bg-grad-e:#fcb69f; 
            --card-bg:#fff; --brdr-clr:#ddd; --timer-clr:#e74c3c; --txt-light:#fff;   
        }

        body{
            font-family:'Comic Neue',cursive;margin:0;padding:0;
            background:linear-gradient(to right,var(--bg-grad-s),var(--bg-grad-e));
            color:var(--prime-txt);text-align:center;
            display:flex;justify-content:center;align-items:center;
            min-height:100vh;font-size:18px;line-height:1.5;
        }

        .container{
            background-color:var(--card-bg);border-radius:15px;
            box-shadow:0 8px 20px rgba(0,0,0,.15);padding:30px;
            width:100%;max-width:550px;box-sizing:border-box;margin:20px;
        }

        /* Headings & Timer */
        h2,h3{margin:10px 0 25px;color:var(--prime-txt);font-weight:700;}
        h2{font-size:2.5em;}
        h3{font-size:1.8em;}

        .timer{
            font-size:2.2em;color:var(--timer-clr);margin-bottom:25px;
            font-weight:bold;
        }

        /* Input Fields */
        input[type="text"],input[type="password"]{
            width:calc(100% - 24px);padding:12px;margin-top:15px;
            border:2px solid var(--btn-green);border-radius:8px;
            font-size:1.1em;color:var(--prime-txt);box-sizing:border-box;
            transition:border-color .3s,box-shadow .3s;
        }
        input[type="text"]:focus,input[type="password"]:focus{
            border-color:var(--btn-green-h);outline:none;
            box-shadow:0 0 8px rgba(76,175,80,.3);
        }

        button,.btn{
            display:inline-block;background-color:var(--btn-green);
            color:var(--txt-light);padding:14px 28px;margin:20px 10px 0; /* Adjusted margin for multiple buttons */
            border:none;border-radius:25px;font-size:1.1em;cursor:pointer;
            transition:background-color .3s,transform .2s;
            font-weight:bold;box-shadow:0 4px 10px rgba(0,0,0,.1);
        }
        button:hover,.btn:hover{
            background-color:var(--btn-green-h);transform:translateY(-2px);
            box-shadow:0 6px 12px rgba(0,0,0,.15);
        }

        #logo {
            width: 150px; 
            height: auto; 
            margin-bottom: 25px;
            border-radius: 10px; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.1); }

        .question{
            background:var(--card-bg);padding:25px;border-radius:15px;
            box-shadow:0 4px 10px rgba(0,0,0,.1);margin-top:25px;
            text-align:left;
        }
        .options{display:flex;flex-direction:column;gap:15px;}
        .options label{
            display:flex;align-items:center;padding:15px;
            border:2px solid var(--brdr-clr);border-radius:10px;
            cursor:pointer;font-size:1.1em;
            transition:background-color .2s,border-color .2s,transform .1s;
            background-color:#f9f9f9;
        }
        .options label:hover{
            background-color:#f0f0f0;border-color:var(--btn-green);
            transform:translateY(-1px);
        }
        .options input[type="radio"],.options input[type="checkbox"]{
            margin-right:15px;transform:scale(1.4);
            -webkit-appearance:none;appearance:none;
            width:22px;height:22px;
            border:2px solid var(--btn-green);border-radius:50%;
            outline:none;cursor:pointer;position:relative;flex-shrink:0;
            transition:background-color .2s,border-color .2s;
        }
        .options input[type="checkbox"]{border-radius:6px;}
        .options input[type="radio"]:checked,.options input[type="checkbox"]:checked{
            background-color:var(--btn-green);border-color:var(--btn-green);
        }
        .options input[type="radio"]:checked::before{
            content:'';width:10px;height:10px;
            background-color:var(--txt-light);border-radius:50%;
            position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
        }
        .options input[type="checkbox"]:checked::before{
            content:'âœ”';font-size:14px;color:var(--txt-light);
            position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
        }
        .options input[type="radio"]:checked+label,
        .options input[type="checkbox"]:checked+label{
            background-color:var(--btn-green);color:var(--txt-light);
            border-color:var(--btn-green);
            box-shadow:0 2px 8px rgba(76,175,80,.3);
        }
        .options input[type="radio"]:checked+label:hover,.options input[type="checkbox"]:checked+label:hover{
            background-color:var(--btn-green);
        }
        #result-page fieldset{
            border:3px solid var(--btn-green);border-radius:20px;
            padding:30px;margin-top:25px;background-color:#f0fff0;
            box-shadow:0 6px 15px rgba(0,0,0,.1);
        }
        #result-page legend{
            font-family:'Comic Neue',cursive;font-size:2em;
            font-weight:bold;color:var(--btn-green);padding:0 20px;text-align:center;
        }
        #result-page p,#result-page div b{
            font-size:1.3em;color:var(--prime-txt);margin:12px 0;
        }
        .congratulations-message{
            color:var(--btn-green);font-weight:bold;font-size:1.6em;
            margin-bottom:20px;
        }
        .navigation-buttons { 
            display: flex;justify-content: center;gap: 20px; margin-top: 30px;
        }
        .hidden{display:none;}
        #submit-section{margin-top:30px;}
        #customMessageBox {
            position:fixed; top:50%; left:50%; transform:translate(-50%, -50%);
            background-color:white; padding:25px; border-radius:15px;
            box-shadow:0 5px 15px rgba(0,0,0,0.3); z-index:1001; text-align:center;
            font-family:'Comic Neue', cursive; color:#2c3e50; max-width:80%;
            border: 2px solid var(--btn-green); 
        }
        #customMessageBox button {
            background-color:#4CAF50; color:white; padding:10px 20px;
            border:none; border-radius:20px; cursor:pointer; margin-top:15px;
            font-weight:bold; box-shadow: none;
        }
        #customMessageBox button:hover {
            background-color:#45a049; transform:none;
        }
        .custom-modal {
            display: none; 
            position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: var(--card-bg); margin: 15% auto; padding: 20px;
            border: 1px solid #888; border-radius: 10px;
            width: 80%; max-width: 400px; text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .modal-buttons button {
            margin: 10px; padding: 10px 20px;
            font-size: 1em; border-radius: 20px;
            box-shadow: none; 
        }

        .modal-buttons button.cancel {
            background-color: #ccc; color: var(--prime-txt);
        }
        .modal-buttons button.cancel:hover {
            background-color: #bbb; transform: none;
        }
        @media (max-width:600px){
            body{padding:10px;}
            .container{padding:20px;margin:10px;}
            h2{font-size:2em;}
            h3{font-size:1.5em;}
            .timer{font-size:1.8em;}
            input[type="text"],input[type="password"]{width:calc(100% - 20px);padding:10px;font-size:1em;}
            button,.btn{padding:10px 20px;font-size:1em;margin-top:15px;}
            .question h3{font-size:1.3em;}
            .options label{padding:12px;font-size:1em;}
            .options input[type="radio"],.options input[type="checkbox"]{transform:scale(1.2);margin-right:10px;}
            .navigation-buttons {
                flex-direction: column; 
                gap: 10px;
            }
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <div class="container" id="signup-page">
        <img src="./assets/-CHURCH LOGO-.jpg" alt="Church Logo" id="logo">
        <h2>THE WAY OF GOD BIBLE MINISTRY</h2>
        <h3>Sunday School Exam - Sign Up</h3>
        <div class="form-group"><input type="text" placeholder="First Name" id="first-name"></div>
        <div class="form-group"><input type="text" placeholder="Last Name" id="last-name"></div>
        <div class="form-group"><input type="password" placeholder="Password" id="password"></div>
        <button onclick="generateID()">Sign Up</button>
    </div>

    <div class="container" id="login-page" style="display:none;">
        <h2>Login to Exam</h2>
        <div class="form-group"><input type="text" placeholder="Your Name" id="login-name"></div>
        <div class="form-group"><input type="text" placeholder="Generated ID" id="generated-id"></div>
        <button onclick="startExam()">Log In</button>
    </div>

    <div class="container" id="instructions-page" style="display:none;">
        <h2>Exam Instructions</h2>
        <p>
            - Read all questions carefully<br>
            - Choose only ONE option<br>
            - You have 10 minutes to complete<br>
            - Exam malpractice is strictly prohibited
        </p>
        <button onclick="loadQuestions()">Begin Exam</button>
    </div>

<div class="container" id="exam-page" style="display:none;">
    <div class="timer" id="countdown">10:00</div>
    
    <div class="question" id="question1" style="display:none;">
        <h3>1. What kind of leaders were Moses and Joshua?</h3>
        <div class="options">
            <label><input type="radio" name="q1" value="a"> Bad leaders</label>
            <label><input type="radio" name="q1" value="b"> Corrupt leaders</label>
            <label><input type="radio" name="q1" value="c"> Good leaders</label>
        </div>
        <div class="navigation-buttons"><button onclick="nextQuestion(1)">Next</button></div>
    </div>
    <div class="question" id="question2" style="display:none;">
        <h3>2. Whom did God instruct to go up against the Canaanites?</h3>
        <div class="options">
            <label><input type="radio" name="q2" value="a"> Israel</label>
            <label><input type="radio" name="q2" value="b"> Judah</label>
            <label><input type="radio" name="q2" value="c"> Jesus</label>
        </div>
        <div class="navigation-buttons"><button onclick="previousQuestion(2)">Previous</button><button onclick="nextQuestion(2)">Next</button></div>
    </div>
    <div class="question" id="question3" style="display:none;">
        <h3>3. What was the disobedience of the Israelites?</h3>
        <div class="options">
            <label><input type="radio" name="q3" value="a"> They love God</label>
            <label><input type="radio" name="q3" value="b"> They worshipped idols</label>
            <label><input type="radio" name="q3" value="c"> They worship Hindus</label>
        </div>
        <div class="navigation-buttons"><button onclick="previousQuestion(3)">Previous</button><button onclick="nextQuestion(3)">Next</button></div>
    </div>
    <div class="question" id="question4" style="display:none;">
        <h3>4. What was the result of their disobedience?</h3>
        <div class="options">
            <label><input type="radio" name="q4" value="a"> They became prey of their enemies</label>
            <label><input type="radio" name="q4" value="b"> They were in the wilderness for 40 years</label>
            <label><input type="radio" name="q4" value="c"> They became very hungry</label>
        </div>
        <div class="navigation-buttons"><button onclick="previousQuestion(4)">Previous</button><button onclick="nextQuestion(4)">Next</button></div>
    </div>
    <div class="question" id="question5" style="display:none;">
        <h3>5.Who was Othniel and what role did he play in Israel?</h3>
        <div class="options">
            <label><input type="radio" name="q5" value="a"> He was the first judge to deliver Israel</label>
            <label><input type="radio" name="q5" value="b"> He was a corrupt leader</label>
            <label><input type="radio" name="q5" value="c"> He led Israel to idolatry</label>
        </div>
        <div class="navigation-buttons"><button onclick="previousQuestion(5)">Previous</button><button onclick="nextQuestion(5)">Next</button></div>
    </div> 
            
    <div class="question" id="question6" style="display:none;">
        <h3>6. Who led the battle against Sisera?</h3>
        <div class="options">
            <label><input type="radio" name="q6" value="a"> Deborah</label>
            <label><input type="radio" name="q6" value="b"> Jael</label>
            <label><input type="radio" name="q6" value="c"> Jabin</label>
        </div>
        <div class="navigation-buttons"><button onclick="previousQuestion(6)">Previous</button><button onclick="nextQuestion(6)">Next</button></div>
    </div>
    <div class="question" id="question7" style="display:none;">
        <h3>7. Who prophesied the death of Sisera?</h3>
        <div class="options">
            <label><input type="radio" name="q7" value="a"> Jael</label>
            <label><input type="radio" name="q7" value="b"> Deborah</label>
            <label><input type="radio" name="q7" value="c"> Solomon</label>
        </div>
        <div class="navigation-buttons"><button onclick="previousQuestion(7)">Previous</button><button onclick="nextQuestion(7)">Next</button></div>
    </div>
    <div class="question" id="question8" style="display:none;">
        <h3>8. Who is Gideon?</h3>
        <div class="options">
            <label><input type="radio" name="q8" value="a"> The mighty man of valour</label>
            <label><input type="radio" name="q8" value="b"> The man with dread</label>
            <label><input type="radio" name="q8" value="c"> The big man</label>
        </div>
        <div class="navigation-buttons"><button onclick="previousQuestion(8)">Previous</button><button onclick="nextQuestion(8)">Next</button></div>
    </div>
    <div class="question" id="question9" style="display:none;">
        <h3>9. SIN can be defined as ________ </h3>
        <div class="options">
            <label><input type="radio" name="q9" value="a"> Sun in Netherlands</label>
            <label><input type="radio" name="q9" value="b"> Simple Instruction Neglected</label>
            <label><input type="radio" name="q9" value="c"> Something in Nigeria</label>
        </div>
        <div class="navigation-buttons"><button onclick="previousQuestion(9)">Previous</button><button onclick="nextQuestion(9)">Next</button></div>
    </div>
    <div class="question" id="question10" style="display:none;">
        <h3>10. What is an Angel?</h3>
        <div class="options">
            <label><input type="radio" name="q10" value="a"> God's Servant to serve God's people</label>
            <label><input type="radio" name="q10" value="b"> Angels are human beings</label>
            <label><input type="radio" name="q10" value="c"> They are servants of Satan</label>
        </div>
        <div class="navigation-buttons"><button onclick="previousQuestion(10)">Previous</button><button onclick="nextQuestion(10)">Next</button></div>
    </div>
    <div class="question" id="question11" style="display:none;">
        <h3>11. How many daughters did Lot have?</h3>
        <div class="options">
            <label><input type="radio" name="q11" value="a"> 4</label>
            <label><input type="radio" name="q11" value="b"> 3</label>
            <label><input type="radio" name="q11" value="c"> 2</label>
        </div>
        <div class="navigation-buttons"><button onclick="previousQuestion(11)">Previous</button><button onclick="nextQuestion(11)">Next</button></div>
    </div>
    <div class="question" id="question12" style="display:none;">
        <h3>12. Who looked back?</h3>
        <div class="options">
            <label><input type="radio" name="q12" value="a"> Deborah</label>
            <label><input type="radio" name="q12" value="b"> Lot's Wife</label>
            <label><input type="radio" name="q12" value="c"> Sarah</label>
        </div>
        <div class="navigation-buttons"><button onclick="previousQuestion(12)">Previous</button><button onclick="nextQuestion(12)">Next</button></div>
    </div>
    <div class="question" id="question13" style="display:none;">
        <h3>13. What is the name of Sarah's maidservant?</h3>
        <div class="options">
            <label><input type="radio" name="q13" value="a"> Hager</label>
            <label><input type="radio" name="q13" value="b"> Abigael</label>
            <label><input type="radio" name="q13" value="c"> Lola</label>
        </div>
        <div class="navigation-buttons"><button onclick="previousQuestion(13)">Previous</button><button onclick="nextQuestion(13)">Next</button></div>
    </div>
    <div class="question" id="question14" style="display:none;">
        <h3>14. Who is the father of Ismael?</h3>
        <div class="options">
            <label><input type="radio" name="q14" value="a"> Abraham</label>
            <label><input type="radio" name="q14" value="b"> Jacob</label>
            <label><input type="radio" name="q14" value="c"> Isaac</label>
        </div>
        <div class="navigation-buttons"><button onclick="previousQuestion(14)">Previous</button><button onclick="nextQuestion(14)">Next</button></div>
    </div>
    <div class="question" id="question15" style="display:none;">
        <h3>15. All these people are those Angels communicated to through dream except ______</h3>
        <div class="options">
            <label><input type="radio" name="q15" value="a"> Joseph</label>
            <label><input type="radio" name="q15" value="b"> Solomon</label>
            <label><input type="radio" name="q15" value="c"> Mary</label>
        </div>
        <div class="navigation-buttons">
            <button onclick="previousQuestion(15)">Previous</button>
            <button onclick="nextQuestion(15)">Next</button></div>
    </div>
    <div class="question" id="question16" style="display:none;">
        <h3>16. All these people are those that angels communicated to one-on-one except ______</h3>
        <div class="options">
            <label><input type="radio" name="q16" value="a"> Mary</label>
            <label><input type="radio" name="q16" value="b"> Abraham</label>
            <label><input type="radio" name="q16" value="c"> Daniel</label>
        </div>
        <div class="navigation-buttons">
            <button onclick="previousQuestion(16)">Previous</button>
            <button onclick="nextQuestion(16)">Next</button></div>
    </div>
    <div class="question" id="question17" style="display:none;">
        <h3>17. Are Angels ghost?</h3>
        <div class="options">
            <label><input type="radio" name="q17" value="a"> I don't know</label>
            <label><input type="radio" name="q17" value="b"> Yes</label>
            <label><input type="radio" name="q17" value="c"> No</label>
        </div>
        <div class="navigation-buttons"> <button onclick="previousQuestion(17)">Previous</button>
            <button onclick="nextQuestion(17)">Next</button> </div>
    </div>
    <div class="question" id="question18" style="display:none;">
        <h3>18. What is the name of the Angel that wages war against Satan?</h3>
        <div class="options">
            <label><input type="radio" name="q18" value="a"> Angel Uriel</label>
            <label><input type="radio" name="q18" value="b"> Angel Michael</label>
            <label><input type="radio" name="q18" value="c"> Angel Echabod</label>
        </div>
        <div class="navigation-buttons"><button onclick="previousQuestion(18)">Previous</button>
            <button onclick="nextQuestion(18)">Next</button></div>
    </div>
    <div class="question" id="question19" style="display:none;">
        <h3>19. Who was the first Pastor of the first gospel Church?</h3>
        <div class="options">
            <label><input type="radio" name="q19" value="a"> Peter</label>
            <label><input type="radio" name="q19" value="b"> Luke</label>
            <label><input type="radio" name="q19" value="c"> John</label>
        </div>
        <div class="navigation-buttons"><button onclick="previousQuestion(19)">Previous</button>
            <button onclick="nextQuestion(19)">Next</button></div>
    </div>
    <div class="question" id="question20" style="display:none;">
        <h3>20. How can one become prey to the devil?</h3>
        <div class="options">
            <label><input type="radio" name="q20" value="a"> Without Prayer</label>
            <label><input type="radio" name="q20" value="b"> With Prayer</label>
            <label><input type="radio" name="q20" value="c"> By Praising God</label>
        </div>
        <div class="navigation-buttons">
            <button onclick="previousQuestion(20)">Previous</button>
            <button onclick="nextQuestion(20)">Submit</button>
        </div>
    </div>
    <div id="submit-section" style="display:none;">
        <button onclick="confirmSubmit()">Submit Exam</button>
    </div>
</div>
    <div class="container" id="result-page" style="display:none;">
        <fieldset>
            <legend><b>EXAM SUCCESSFUL</b></legend>
            <br>
            <div><center class="congratulations-message">ðŸŽ‰ CONGRATULATIONS! ðŸŽ‰ You have successfully ended the examinations .......</center></div>
            <br>
            <div><center><b>Your result will be sent shortly...</b></center></div>
        </fieldset>
    </div>
    <div id="customMessageBox" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background-color:white; padding:25px; border-radius:15px; box-shadow:0 5px 15px rgba(0,0,0,0.3); z-index:1001; text-align:center; font-family:'Comic Neue', cursive; color:#2c3e50; max-width:80%;">
        <p id="messageBoxText"></p>
        <button onclick="hideMessageBox()">OK</button>
    </div>
    <div id="confirmModal" class="custom-modal">
        <div class="modal-content">
            <p id="modalMessage">Are you sure you want to proceed?</p>
            <div class="modal-buttons">
                <button id="modalConfirmBtn">Yes</button>
                <button id="modalCancelBtn" class="cancel">No</button>
            </div>
        </div>
    </div>

<script>
// Your web app's Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyBcAU4wF6scW2wmBmDn2BbE8Lf_jbXsCrU",
    authDomain: "sunday-cbt.firebaseapp.com",
    projectId: "sunday-cbt",
    storageBucket: "sunday-cbt.firebasestorage.app",
    messagingSenderId: "1081445319494",
    appId: "1:1081445319494:web:8149a46380b55ae85c5b47"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let generatedId = '';
let userName = '';
let currentQuestion = 1;
let totalQuestions = 20;
let answers = {};
let timer;

// Define correct answers to avoid duplication
const CORRECT_ANSWERS = {
    1: 'c', 2: 'b', 3: 'b', 4: 'a', 5: 'a',
    6: 'b', 7: 'b', 8: 'a', 9: 'b', 10: 'a',
    11: 'c', 12: 'b', 13: 'a', 14: 'a', 15: 'c',
    16: 'c', 17: 'c', 18: 'b', 19: 'a', 20: 'a'
};

// Cached DOM elements - populated on DOMContentLoaded
const DOM = {};

// --- Custom Message Box for Notifications ---
function showMessageBox(message) {
    DOM.messageBoxText.textContent = message;
    DOM.customMessageBox.style.display = 'block';
}

function hideMessageBox() {
    DOM.customMessageBox.style.display = 'none';
}

// --- Custom Confirmation Modal for Yes/No prompts ---
let pendingAction = null; // To store the function to execute on modal confirm

function showModal(message, onConfirm) {
    DOM.modalMessage.textContent = message;
    pendingAction = onConfirm;
    DOM.confirmModal.style.display = 'block';
}

function hideModal() {
    DOM.confirmModal.style.display = 'none';
    pendingAction = null;
}

// Event listeners and DOM caching
document.addEventListener('DOMContentLoaded', () => {
    // Cache common DOM elements
    DOM.customMessageBox = document.getElementById('customMessageBox');
    DOM.messageBoxText = document.getElementById('messageBoxText');
    DOM.confirmModal = document.getElementById('confirmModal');
    DOM.modalMessage = document.getElementById('modalMessage');
    DOM.modalConfirmBtn = document.getElementById('modalConfirmBtn');
    DOM.modalCancelBtn = document.getElementById('modalCancelBtn');

    DOM.signupPage = document.getElementById('signup-page');
    DOM.loginPage = document.getElementById('login-page');
    DOM.instructionsPage = document.getElementById('instructions-page');
    DOM.examPage = document.getElementById('exam-page');
    DOM.resultPage = document.getElementById('result-page');
    DOM.firstNameInput = document.getElementById('first-name');
    DOM.lastNameInput = document.getElementById('last-name');
    DOM.passwordInput = document.getElementById('password');
    DOM.loginNameInput = document.getElementById('login-name');
    DOM.generatedIdInput = document.getElementById('generated-id');
    DOM.countdownDisplay = document.getElementById('countdown');
    DOM.submitSection = document.getElementById('submit-section'); // Though this section is largely redundant now

    // Event listeners for the confirmation modal buttons
    DOM.modalConfirmBtn.addEventListener('click', () => {
        if (pendingAction) {
            pendingAction();
        }
        hideModal();
    });

    DOM.modalCancelBtn.addEventListener('click', hideModal);
});
// Generate unique ID for signup
function generateID() {
    const firstName = DOM.firstNameInput.value;
    const lastName = DOM.lastNameInput.value;
    const password = DOM.passwordInput.value; // Password is still collected but not used for Firebase Auth here

    if (!firstName || !lastName || !password) {
        showMessageBox('Please fill all fields');
        return;
    }
    generatedId = 
        firstName.substring(0, 3).toUpperCase() + 
        lastName.substring(lastName.length - 3).toUpperCase() + 
        Math.floor(1000 + Math.random() * 9000);

    DOM.signupPage.style.display = 'none';
    DOM.loginPage.style.display = 'block';
    showMessageBox(`Your Generated ID is: ${generatedId}. Please remember it!`);
}
// Login Function
function startExam() {
    const loginName = DOM.loginNameInput.value;
    const loginId = DOM.generatedIdInput.value;

    if (loginId !== generatedId) { // This still relies on `generatedId` being in memory.
        showMessageBox('Invalid ID. Please try again.');
        return;
    }

    userName = loginName;

    DOM.loginPage.style.display = 'none';
    DOM.instructionsPage.style.display = 'block';
}

// Load Questions
function loadQuestions() {
    DOM.instructionsPage.style.display = 'none';
    DOM.examPage.style.display = 'block';
    document.getElementById('question1').style.display = 'block'; // Always start with Q1
    startTimer();
}
// Timer Function
function startTimer() {
    let timeLeft = 600; // 10 minutes

    timer = setInterval(() => {
        const minutes = Math.floor(timeLeft / 60).toString().padStart(2, '0');
        const seconds = (timeLeft % 60).toString().padStart(2, '0');
        DOM.countdownDisplay.textContent = `${minutes}:${seconds}`;

        if (timeLeft <= 0) {
            clearInterval(timer);
            submitExam(); // Auto submit when time ends
        }
        timeLeft--;
    }, 1000);
}
// Helper to manage question display
function displayQuestion(qNum) {
    // Hide current question and submit section (if visible)
    document.getElementById(`question${currentQuestion}`).style.display = 'none';
    DOM.submitSection.style.display = 'none';

    // Update currentQuestion and show the new one
    currentQuestion = qNum;
    document.getElementById(`question${currentQuestion}`).style.display = 'block';

    // Re-select the previously chosen answer if it exists
    if (answers[currentQuestion]) {
        const selectedOption = document.querySelector(`input[name="q${currentQuestion}"][value="${answers[currentQuestion]}"]`);
        if (selectedOption) {
            selectedOption.checked = true;
        }
    }
}
// Navigate to the next question
function nextQuestion(qNum) {
    const selectedOption = document.querySelector(`input[name="q${qNum}"]:checked`);
    if (selectedOption) {
        answers[qNum] = selectedOption.value;
    } else {
        showMessageBox('Please select an answer before proceeding.');
        return; // Prevent moving if no option is selected
    }

    if (qNum === totalQuestions) {
        confirmSubmit(); // Call confirmSubmit for the final question
        return;
    }
    
    displayQuestion(qNum + 1);
}
// Navigate to the previous question
function previousQuestion(qNum) {
    if (qNum > 1) {
        // Store current answer before going back
        const selectedOption = document.querySelector(`input[name="q${qNum}"]:checked`);
        if (selectedOption) {
            answers[qNum] = selectedOption.value;
        }
        displayQuestion(qNum - 1);
    }
}
// Confirm Submission - Now uses custom modal
function confirmSubmit() {
    showModal('Are you sure you want to submit the exam?', submitExam);
}
// Submit Exam
function submitExam() {
    clearInterval(timer); // Stop the timer

    const score = calculateScore();

    DOM.examPage.style.display = 'none';
    DOM.resultPage.style.display = 'block';

    const examResult = {
        name: userName,
        examId: generatedId,
        timestamp: new Date().toLocaleString(),
        score: score,
        totalQuestions: totalQuestions,
        percentage: ((score / totalQuestions) * 100).toFixed(2) + '%',
        answers: answers,
        correctAnswers: CORRECT_ANSWERS // Uses the global constant
    };

    storeExamResult(examResult);
}
// Score Calculation Function
function calculateScore() {
    let score = 0;
    for (let i = 1; i <= totalQuestions; i++) {
        if (answers[i] === CORRECT_ANSWERS[i]) { // Uses the global constant
            score++;
        }
    }
    return score;
}
// Function to send results to Firestore
async function storeExamResult(result) {
    try {
        await db.collection('examResults').add(result);
        console.log("Exam result successfully written to Firestore!");
        // You can add a success message or redirect here if needed
    } catch (error) {
        console.error("Error writing exam result to Firestore: ", error);
        showMessageBox("There was an error saving your result. Please try again later or contact support.");
    }
}
</script>
</body>
</html>